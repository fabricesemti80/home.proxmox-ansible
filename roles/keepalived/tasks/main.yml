---
- name: Install Keepalived
  apt:
    name: keepalived
    state: present

- name: Configure Keepalived
  template:
    src: "keepalived.conf.j2"
    dest: /etc/keepalived/keepalived.conf
  notify: Restart Keepalived

- name: Ensure Keepalived is running and enabled
  systemd:
    name: keepalived
    state: started
    enabled: yes

- name: Display High Availability Access URL
  ansible.builtin.debug:
    msg:
      - "====================================================="
      - " PROXMOX GUI HA CONFIGURATION COMPLETE"
      - "-----------------------------------------------------"
      - " Access URL: https://{{ proxmox_vip }}:8006"
      - " Floating IP: {{ proxmox_vip }}"
      - " Status: Active (Round-Robin via Keepalived)"
      - "====================================================="
  run_once: true