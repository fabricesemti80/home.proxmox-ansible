global_defs {
    router_id {{ ansible_hostname }}
}

vrrp_instance VI_1 {
    state BACKUP
    interface vmbr0
    virtual_router_id 51
    # Priority: higher number wins. Calculating based on IP octet.
    priority {{ 100 + (ansible_host.split('.')[-1] | int) }}
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass {{ lookup('env', 'KEEPALIVED_PASSWORD') | default('backup_pass_123') }}
    }
    virtual_ipaddress {
        {{ proxmox_vip }}/24
    }
}