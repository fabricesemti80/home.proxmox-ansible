# Terraform Proxmox Configuration
# Generated: {{ ansible_date_time.iso8601 }}

# Load token from terraform@pve-automation.token file:
# source tokens/terraform@pve-automation.token
# export TF_VAR_proxmox_token_secret="$TOKEN_SECRET"

terraform {
  required_providers {
    proxmox = {
      source  = "telmate/proxmox"
      version = "~> 2.9"
    }
  }
}

variable "proxmox_token_secret" {
  description = "Proxmox API token secret"
  type        = string
  sensitive   = true
}

provider "proxmox" {
  pm_api_url          = "https://{{ hostvars[groups['pve01'][0]]['ansible_host'] }}:8006/api2/json"
  pm_api_token_id     = "terraform@pve!automation"
  pm_api_token_secret = var.proxmox_token_secret
  pm_tls_insecure     = true
}