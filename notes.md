# Notes of my current proxmox setup

## Missing `sudo`

<https://linuxways.net/debian/fix-sudo-command-not-found-debian-12/>

## Storage folders

### nfs-proxmox-backup

- ID: nfs-proxmox-backup
- Server: 10.0.40.2
- Export: /proxmox-backup

### nfs-proxmox-iso

- ID: nfs-proxmox-iso
- Server: 10.0.40.2
- Export: /proxmox-iso

### nfs-proxmox-template

- ID: nfs-proxmox-template
- Server: 10.0.40.2
- Export: /proxmox-template

## Network config of Proxmox

### pve-0

```sh
root@pve-0:~# sudo cat /etc/network/interfaces
# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

auto lo
iface lo inet loopback

iface enp2s0 inet manual

iface enx7cc2c64ca36f inet manual

auto eth0
iface eth0 inet static
        address 10.0.70.10/24

auto vmbr0
iface vmbr0 inet static
        address 10.0.40.10/24
        gateway 10.0.40.1
        bridge-ports enp2s0
        bridge-stp off
        bridge-fd 0

iface wlp3s0 inet manual

source /etc/network/interfaces.d/*
root@pve-0:~#
```

### pve-1

```sh
root@pve-1:~# sudo cat /etc/network/interfaces
# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

auto lo
iface lo inet loopback

iface enp2s0 inet manual

iface wlp3s0 inet manual

iface enx7cc2c64b4dc4 inet manual

auto eth0
iface eth0 inet static
        address 10.0.70.11/24

auto vmbr0
iface vmbr0 inet static
        address 10.0.40.11/24
        gateway 10.0.40.1
        bridge-ports enp2s0
        bridge-stp off
        bridge-fd 0

source /etc/network/interfaces.d/*
root@pve-1:~#
```

### pve-2

```sh
root@pve-2:~# sudo cat /etc/network/interfaces
# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

auto lo
iface lo inet loopback

iface enp2s0 inet manual

iface enx7cc2c64b6389 inet manual

auto eth0
iface eth0 inet static
        address 10.0.70.12/24

auto vmbr0
iface vmbr0 inet static
        address 10.0.40.12/24
        gateway 10.0.40.1
        bridge-ports enp2s0
        bridge-stp off
        bridge-fd 0

iface wlp3s0 inet manual

source /etc/network/interfaces.d/*
root@pve-2:~#
```

## Server preparation

### Install Debian 12

- Install Debian 12
  - [Download ISO](https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/)
  - [Install guide](https://www.debian.org/releases/bookworm/amd64/installers/index.en.html)
  - My important choices:
    - use entire disk (nvme drive of my Mini PC)
    - `enp2s0` interface - DHCP for install, static after (see below config)
    - no domain name
    - de-select `Desktop environment`, `GNOME` but add `SSH server`

### Continue configuration

#### Configure network interfaces, for example:

```sh
# Backup current config
sudo cp /etc/network/interfaces /etc/network/interfaces.backup

# Edit current config
sudo nano /etc/network/interfaces

# Example config
auto ens18 # can be different
iface ens18 inet static
    address 10.0.40.256             # changeme
    netmask 255.255.255.0           # changeme
    gateway 10.0.40.1               # changeme
    dns-nameservers 8.8.8.8 8.8.4.4 # changeme

# restart networking
sudo systemctl restart networking

# or reboot
sudo reboot
```

#### Enable password auth

```sh
# Backup config
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

# Edit current config
sudo nano /etc/ssh/sshd_config

# Uncomment this line
PasswordAuthentication yes

# restart service
sudo systemctl restart sshd
```

#### Temporary enable `root` login with password

```sh
# Backup config
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

# Edit current config
sudo nano /etc/ssh/sshd_config

# Add this line near "PermitRootLogin prohibit-password"
PermitRootLogin yes

# restart service
sudo systemctl restart sshd
```

#### Clean-up Ceph, if had this

```sh
# Check for Ceph volumes with
lsblk

# Check if LVM tools are installed
which pvs || apt update && apt install -y lvm2

# If found, stop Ceph
systemctl stop ceph-osd@*

# remove LVM volume
lvremove ceph-fb745f13-d769-4943-8a42-3ed9606a77f3/osd-block-5136f691-5432-48f5-9e28-73dee469e3f1

# Remove volume group
vgremove ceph-fb745f13-d769-4943-8a42-3ed9606a77f3

# Remove physical volume info
pvremove /dev/sda  # (or pveremove /dev/nvme0n1 if Ceph was on this)

# install gdisk
apt install gdisk

# Wipe disk
sgdisk --zap-all /dev/sda # (or sgdisk --zap-all /dev/nvme0n1 if Ceph was on this)
```
